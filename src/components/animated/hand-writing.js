/* eslint-disable react/prop-types */
/* eslint-disable react/no-array-index-key */
import React, { useEffect } from 'react'
import Svg, { Defs, G, Path } from 'react-native-svg'
import Animated, {
  Easing,
  useAnimatedStyle,
  useSharedValue,
  withRepeat,
  withTiming,
  runOnJS,
} from 'react-native-reanimated'
import { DISPLAY } from '../../utils/constants'

const AnimatedPath = Animated.createAnimatedComponent(Path)

const Ap = (props) => {
  const {
    index, path, transform, onFinished, repeat,
  } = props

  const animatedLength = useSharedValue(0)

  const totalLength = 50

  const animatedStyle = useAnimatedStyle(() => ({
    strokeDashoffset: animatedLength.value,
    strokeDasharray: [1, animatedLength.value / totalLength],
  }))

  useEffect(() => {
    animatedLength.value = withRepeat(
      withTiming(
        totalLength,
        {
          duration: 500,
          easing: Easing.cubic,
        },
        (finished) => {
          if (finished) {
            runOnJS(onFinished)(true, index)
          }
        },
      ),
      repeat ?? -1, false,
    )
  }, [])

  return (
    <AnimatedPath
      d={path}
      fill={DISPLAY.Palette[9]}
      stroke={DISPLAY.Palette[3]}
      strokeWidth={6}
      style={animatedStyle}
      transform={transform || ''}
    />
  )
}

const HandwrittenAnimation = () => {
  const letterPaths = [
    'm307.43 340.87c-2.1265-0.22249-4.5002 0.24744-6.9453 1.7324-12.255 4.312-12.312 20.637-26.176 20.832-7.0524 9.3714 5.562 7.6391 7.7441 8.127 2.8829 12.04-26.424 22.052-8.1914 29.441 16.342 2.6284 14.446-24.364 22.08-25.602-4.8345 17.141 23.184 14.936 14.336-1.4062 2.9859-9.3047-2.148-24.509-9.9336-9.6973-9.0548 12.149-2.759-16.237 6.668-7.9043 14.219-0.60409 9.633-14.559 0.41797-15.523zm-164.19 0.16406c-4.3088 0.11067-8.6513 2.5436-10.623 6.4648 5.3133 8.5663-10.059 9.8506-3.7754 14.207 7.8603 8.7545-7.6065 26.224-6.6562 37.377 19.204 6.9172 16.334-25.265 20.736-37.248 11.188-0.30811 3.436-5.7757-2.5449-8.4961 4.1186 0.63537 16.317-9.6635 2.8633-12.305zm98.117 0.29687c-14.542-1.375 0.76765 24.928-11.504 14.016-15.497-1.3636-23.583 32.91-6.166 33.16 6.5914-9.1112 12.639 7.0287 20.225-3.6328-3.0557-13.978 9.5878-31.789 0.76953-42.879-1.2518-0.35691-2.3548-0.5724-3.3242-0.66407zm-73.156 0.1504c-2.8504 0.0281-5.9186 1.5486-7.2324 4.1602-4.0574 16.581 26.132-0.54928 7.2324-4.1602zm356.76 0.21679c-5.529 0.68655-12.275 8.3585-7.3867 15.592-13.283 0.0627 4.4142 8.1224-3.8398 15.168-12.813 19.314 20.764 21.702 12.145 1.2324 1.6708-3.2624-0.16439-11.585 5.4551-10.961 9.6029-4.2563-7.8431-5.3445-0.51172-13.119 0.33561-6.2205-2.5439-8.324-5.8613-7.9121zm-54.617 0.0664c-6.2887-0.27919-16.842 8.696-3.9062 11.238 2.7605-0.0996 5.7504-1.0646 7.2324-3.6484 1.5088-5.4238-0.46766-7.4629-3.3262-7.5898zm83.779 12.373c-4.4791-0.37358-9.2515 1.4301-12.293 6.8008-14.984 12.542 2.669 39.802 18.432 23.615 6.8918-13.524-8.2093-4.71-13.055-6.0801 1.5671-3.5812 7.899-2.4076 10.688-5.0547 14.52-7.0991 6.0824-18.459-3.7715-19.281zm-54.795 0.0957c-1.5498-0.10431-3.3944 0.0664-5.582 0.56836-12.352-3.7974-17.804 18.597-3.5 11.449 13.995-3.9021-7.0149 6.6395-11.584 7.6152-11.374 11.667 6.6951 18.652 13.248 12.16 4.634 7.2675 18.332 0.0203 13.377-8 1.3044-8.8298 4.8894-23.063-5.959-23.793zm-163.52 0.1289c-7.301-0.17731-14.91 3.0619-13.43 12.145-0.34577 6.0607 23.132 14.671 6.9121 10.432-17.378-7.144-11.161 19.431 4.2402 12.332 16.286-0.17979 17.374-21.648 0.23828-22.188-0.64778-5.5458 6.4342 0.81447 8.7051-0.25586 11.599-6.3612 2.7209-12.237-6.666-12.465zm35.199 0c-7.301-0.17731-14.91 3.0619-13.43 12.145-0.34577 6.0607 23.132 14.671 6.9121 10.432-17.378-7.144-11.161 19.431 4.2402 12.332 16.286-0.17979 17.376-21.648 0.24023-22.188-0.64778-5.5458 6.4322 0.81447 8.7031-0.25586 11.599-6.3612 2.7209-12.237-6.666-12.465zm-166.96 0.36719-2.0801 0.20899c-7.9454 9.3216-15.387-7.1299-23.215 4.9434 4.8687 9.793-7.6377 21.235-0.24218 28.512 18.278 5.745 6.8522-19.034 17.281-23.551 0.34746 7.8252-5.7781 32.303 11.264 21.184-1.2732-8.9301 9.3111-27.834-3.0078-31.297zm236.63 0.0176c-7.6127-0.23791-17.891 4.8613-17.877 13.295-12.459 18.082 24.992 30.603 22.016 9.0234-6.0008-2.7808-15.645 4.1179-10.432-8.832 2.6071-6.4402 8.9 4.1088 13.119-2.3027 3.4025-7.5841-0.90518-10.999-6.8262-11.184zm-35.363 0.0449c-13.012 1.0584-23.064 21.924-13.555 32.387l1.6973 1.1992 1.7598 0.78516c16.499 4.9357 29.47-19.276 19.375-31.568-3.114-2.2366-6.2746-3.047-9.2773-2.8027zm60.154 0.375c-1.939-0.338-4.6788 0.70265-8.4277 3.8184 0.22873 10.584-11.235 36.587 8.9746 27.602 2.5712-2.9792 1.6743-6.5265 0.81641-9.9043 3.0539-7.0733 4.4538-20.502-1.3633-21.516zm-302.06 8e-3c-2.6741 0.15494-5.2779 1.3742-6.5254 3.8125 0.20027 10.56-11.215 36.598 8.9766 27.598-0.22127-9.4271 5.9306-22.119 2.1602-30.574-1.3778-0.63928-3.0069-0.9289-4.6113-0.83594zm389.06 8.4453c7.0506-0.90188-9.1152 12.977-3.0137 1.6699l1.2812-1.2793c0.68988-0.20334 1.2624-0.3305 1.7324-0.39062zm-147.82 1.6445c0.69543 0.15937 1.3622 0.95764 1.8945 2.7129 1.5118 7.7565-8.7571 17.203-6.0918 4.6094-0.23516-2.5175 2.111-7.8004 4.1973-7.3223zm-173.95 0.39258c3.509 0.10366 1.7231 3.912 1.5508 5.8476-1.756 13.591-9.702-1.078-1.5508-5.8476zm260.13 9.4258c9.3358-0.20483-9.5432 9.6978-1.8555 1.0879z',
    'm183.65 0.019531c-1.6793 0.10792-3.4728 0.65189-5.3066 1.7656-12.255 4.312-12.312 20.637-26.176 20.832-7.0524 9.3714 5.562 7.6391 7.7441 8.127 2.8829 12.04-26.424 22.052-8.1914 29.441 16.342 2.6284 14.445-24.364 22.08-25.602-4.8345 17.141 23.184 14.936 14.336-1.4062 2.9859-9.3047-2.148-24.509-9.9336-9.6973-9.0548 12.149-2.759-16.237 6.668-7.9043 14.219-0.60409 9.633-14.559 0.41797-15.523-0.53164-0.055621-1.0789-0.069175-1.6387-0.033203zm-162.55 0.19727c-4.3088 0.11067-8.6513 2.5436-10.623 6.4648 5.3133 8.5663-10.059 9.8506-3.7754 14.207 7.8603 8.7545-7.6065 26.224-6.6563 37.377 19.204 6.9172 16.334-25.265 20.736-37.248 11.188-0.30811 3.436-5.7757-2.5449-8.4961 4.1186 0.63537 16.317-9.6635 2.8633-12.305zm98.117 0.29688c-14.542-1.375 0.76765 24.928-11.504 14.016-15.497-1.3636-23.583 32.909-6.166 33.16 6.5914-9.1112 12.639 7.0287 20.225-3.6328-3.0557-13.978 9.5878-31.789 0.76953-42.879-1.2518-0.35691-2.3548-0.5724-3.3242-0.66406zm-73.156 0.15039c-2.8504 0.02805-5.9186 1.5486-7.2324 4.1602-4.0574 16.581 26.132-0.54928 7.2324-4.1602zm357.98 0.18359c-0.39557-0.030245-0.80212-0.018288-1.2168 0.033203-5.529 0.68655-12.275 8.3585-7.3867 15.592-13.283 0.0627 4.4142 8.1224-3.8398 15.168-12.813 19.314 20.764 21.702 12.145 1.2324 1.6708-3.2624-0.16439-11.585 5.4551-10.961 9.6029-4.2563-7.8431-5.3445-0.51172-13.119 0.29366-5.443-1.8756-7.7336-4.6445-7.9453zm-55.834 0.099609c-6.2887-0.27919-16.842 8.696-3.9062 11.238 2.7605-0.0996 5.7504-1.0645 7.2324-3.6484 1.5089-5.4238-0.46766-7.4629-3.3262-7.5898zm83.779 12.373c-4.4791-0.37358-9.2515 1.4301-12.293 6.8008-14.984 12.542 2.669 39.802 18.432 23.615 6.8918-13.524-8.2093-4.71-13.055-6.0801 1.5671-3.5812 7.899-2.4076 10.688-5.0547 14.52-7.0991 6.0824-18.459-3.7715-19.281zm-54.795 0.095704c-1.5498-0.1043-3.3944 0.0664-5.582 0.56836-12.352-3.7974-17.804 18.597-3.5 11.449 13.995-3.9021-7.0149 6.6395-11.584 7.6152-11.374 11.667 6.6951 18.652 13.248 12.16 4.634 7.2675 18.332 0.0203 13.377-8 1.3044-8.8297 4.8894-23.063-5.959-23.793zm-163.52 0.12891c-7.301-0.17732-14.91 3.0619-13.43 12.145-0.34577 6.0607 23.132 14.671 6.9121 10.432-17.378-7.144-11.161 19.431 4.2402 12.332 16.286-0.17979 17.374-21.648 0.23828-22.188-0.64778-5.5458 6.4342 0.81447 8.7051-0.25586 11.599-6.3612 2.7209-12.237-6.666-12.465zm35.199 0c-7.301-0.17732-14.91 3.0619-13.43 12.145-0.34577 6.0607 23.132 14.671 6.9121 10.432-17.378-7.144-11.161 19.431 4.2402 12.332 16.286-0.17979 17.376-21.648 0.24023-22.188-0.64778-5.5458 6.4322 0.81447 8.7031-0.25586 11.599-6.3612 2.7209-12.237-6.666-12.465zm-166.96 0.36719-2.0801 0.20898c-7.9454 9.3216-15.387-7.1299-23.215 4.9434 4.8687 9.793-7.6377 21.235-0.24219 28.512 18.278 5.745 6.8522-19.034 17.281-23.551 0.34746 7.8252-5.7781 32.303 11.264 21.184-1.2732-8.9301 9.3111-27.834-3.0078-31.297zm236.63 0.017579c-7.6127-0.23791-17.891 4.8613-17.877 13.295-12.459 18.082 24.992 30.603 22.016 9.0234-6.0008-2.7808-15.645 4.1179-10.432-8.832 2.6071-6.4402 8.9 4.1088 13.119-2.3027 3.4025-7.5841-0.90519-10.999-6.8262-11.184zm-35.363 0.044921c-13.012 1.0584-23.064 21.924-13.555 32.387l1.6973 1.1992 1.7598 0.78516c16.499 4.9357 29.47-19.276 19.375-31.568-3.114-2.2366-6.2746-3.047-9.2774-2.8027zm60.154 0.375c-1.939-0.338-4.6788 0.70265-8.4277 3.8184 0.22873 10.584-11.235 36.587 8.9746 27.602 2.5712-2.9792 1.6743-6.5265 0.81641-9.9043 3.0539-7.0733 4.4538-20.502-1.3633-21.516zm-302.06 0.007813c-2.6741 0.15494-5.2779 1.3742-6.5254 3.8125 0.20027 10.56-11.215 36.598 8.9766 27.598-0.22127-9.4271 5.9306-22.119 2.1602-30.574-1.3778-0.63928-3.0069-0.9289-4.6113-0.83594zm390.12 8.4395c4.0558 0.74022-9.7944 12.276-4.0742 1.6758l1.2812-1.2793c0.68988-0.20334 1.2624-0.3305 1.7324-0.39062 0.44066-0.056367 0.79016-0.055207 1.0606-0.005859zm-148.88 1.6504c0.69543 0.15937 1.3622 0.95764 1.8945 2.7129 1.5118 7.7565-8.7571 17.203-6.0918 4.6094-0.23516-2.5175 2.111-7.8004 4.1973-7.3223zm-173.95 0.39258c3.509 0.10366 1.7231 3.912 1.5508 5.8477-1.756 13.591-9.702-1.078-1.5508-5.8477zm260.13 9.4258c9.3358-0.20483-9.5432 9.6978-1.8555 1.0879l1.8555-1.0879z',
  ]

  const currentPath = useSharedValue(0)

  const Finished = (finished) => {
    if (finished) {
      currentPath.value = currentPath.value === letterPaths.length - 1 ? 0 : currentPath.value + 1
      // console.log('Finished ', currentPath.value, index)
    }
  }

  return (
    <Svg
      width="70%"
      height="70%"
      viewBox="-32 0 117.35 15.972"
    >
      <Defs>
        <Path id="a" d="M81.747 217.387h383.429v106.414H81.747z" />
      </Defs>
      <G
        transform="translate(-32.317 -90.175) scale(.26458)"
        aria-label="find Associate"
      >
        <Ap index={currentPath.value} path={letterPaths[0]} onFinished={Finished} />
        <Ap index={currentPath.value} path={letterPaths[1]} onFinished={Finished} />
      </G>
    </Svg>
  )
}

export default HandwrittenAnimation
